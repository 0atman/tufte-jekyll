<hr />

<p>layout: post
title:  &ldquo;Tufte-style Jekyll blog&rdquo;
date:   2015-02-19 21:46:04</p>

<h2>categories: jekyll css</h2>

<h2>Introduction</h2>

<p>{% newthought &lsquo;The Tufte Jekyll theme&rsquo; %} is an attempt to create a website design with the look and feel of Edward Tufte&rsquo;s books and handouts. Tufte’s style is known for its extensive use of sidenotes, tight integration of graphics with text, and well-set typography.<!--more--> The idea for this project is essentially cribbed wholesale from Tufte and R Markdown&rsquo;s Tufte Handout format{% sidenote 1  &lsquo;See <a href="https://code.google.com/p/tufte-latex" title="">code.google.com/p/tufte-latex</a> and <a href="http://rmarkdown.rstudio.com/tufte_handout_format.html">rmarkdown.rstudio.com/tufte_handout_format</a> %} This page is an adaptation of the <a href="http://rmarkdown.rstudio.com/examples/tufte-handout.pdf">Tufte Handout PDF</a>.</p>

<h2>Jekyll customizations</h2>

<p>This Jekyll blog theme is based on a github repository by Dave Liepmann <a href="https://github.com/daveliepmann/tufte-css">here</a>, which in turn was based on the <a href="http://rmarkdown.rstudio.com/examples/tufte-handout.pdf">R Markdown Tufte Handout</a>. I borrowed freely from Dave&rsquo;s repo and have transformed many of the typographic and page-structural features into a set of custom Liquid tags that make creating content using this style much easier than writing straight HTML. Essentially, if you know markdown, and mix in a few custom Liquid tags, you can be creating a website with this document style in short order.</p>

<h2>Basics</h2>

<h3>Color</h3>

<p>Although paper handouts obviously have a pure white background, the web is better served by the use of slightly off-white and off-black colors. I picked <code>#fffff8</code> and <code>#111111</code> because they are nearly indistinguishable from their &lsquo;pure&rsquo; cousins, but dial down the harsh contrast. Tufte&rsquo;s books are a study in spare, minimalist design. In his book <a href="http://www.edwardtufte.com/tufte/books_vdqi">The Visual Display of Quantitative Information</a>, he uses a red ink to add some visual punctuation to the buff colored paper and dark ink. In that spirit, links are styled using a similar red color.</p>

<h3>Headings</h3>

<p>Tufte CSS styles headings <code>h1</code>, <code>h2</code>, and <code>h3</code>, making them nearly identical except for font size. The <code>h1</code> should be used as a title, the <code>h2</code>for section headings, and <code>h3</code> for subsection headings.</p>

<p>While this Jekyll theme supports more specific headings, if you feel the urge to reach for a heading of level 4 or higher, consider redesigning your document.</p>

<p>{% newthought &lsquo;In his later books&rsquo; %}{% sidenote 2 &lsquo;<a href="http://www.edwardtufte.com/tufte/books_be">http://www.edwardtufte.com/tufte/books_be</a>&rsquo;%}, Tufte starts each section with a bit of vertical space, a non-indented paragraph, and sets the first few words of the sentence in small caps. To accomplish this using this style, enclose the sentence fragment you want styled with small caps in a custom Liquid tag called &lsquo;newthought&rsquo; like so:</p>

<p><code>
{{ "{% newthought 'In his later books'" }} %}
</code></p>

<h3>Font</h3>

<p>In print, Tufte uses the proprietary Monotype Bembo{% sidenote 3 &lsquo;<a href="http://www.edwardtufte.com/bboard/q-and-a-fetch-msg?msg_id=0000Vt">http://www.edwardtufte.com/bboard</a>&rsquo; %} font. Electronically he uses ETBembo, available under the MIT license through Edward Tufte, Adam Schwartz, and Marc Neuwirth&rsquo;s <a href="https://github.com/edwardtufte/presenter"><em>Presenter</em></a> project. The Tufte Jekyll Theme CSS uses ETBembo through the use of <code>@font-face</code>.</p>

<p>Code snippets ape GitHub&rsquo;s font selection using Microsoft&rsquo;s <a href="http://www.microsoft.com/typography/ClearTypeFonts.mspx"><em>Consolas</em></a> and the sans-serif font uses Tufte&rsquo;s choice of Gill Sans. Since this is not a free font, and some systems will not have it installed, the free google font <a href="https://www.google.com/fonts/specimen/Lato"><em>Lato</em></a> is designated as a fallback.</p>

<h2>Figures</h2>

<h3>Margin Figures</h3>

<p>{% marginfigure /assets/img/figure1.png &lsquo;Figure 1: Sepal length vs. petal length, colored by species&rsquo;  %}Images and graphics play an integral role in Tufte’s work. To place figures in the margin, use the custom margin figure liquid tag included in the <code>_plugins</code> directory like so:</p>

<p><code>{{ "{% marginfigure /assets/img/figure1.png 'Figure 1: Sepal length vs. petal length, colored by species' "}} %}</code>.</p>

<p>Note that the caption <em>must</em> be enclosed in quotes for the simple liquid tag to work!</p>

<h3>Equations</h3>

<p>The Markdown parser being used by this Jekyll theme is Kramdown, which contains some built-in <a href="//www.mathjax.org">Mathjax</a> support. Both inline and block-level mathematical figures can be added to the content.</p>

<p>For instance, the following inline sequence:</p>

<p><em>When {% m %}a \ne 0{% em %}, there are two solutions to {% m %}ax<sup>2</sup> + bx + c = 0{% em %}</em></p>

<p>is written by enclosing a Mathjax expression with a <em>Liquid inline tag pair</em> (&rsquo;m' and &lsquo;em&rsquo;) like so:</p>

<p><code>When {{ "{% m "}}%} a \ne 0{{ "{% em "}}%}, there are two solutions to {{ "{% m " }}%}ax^2 + bx + c = 0{{ "{% em " }}%}</code></p>

<p>Similarly, this block-level Mathjax expression: {% math %}x = {-b \pm \sqrt{b<sup>2</sup>-4ac} \over 2a}.{% endmath %}</p>

<p>is written by enclosing the expression with a <em>Liquid block tag pair</em> (&lsquo;math&rsquo; and &lsquo;endmath&rsquo;) like so:</p>

<p><code>{{ "{% math "}}%}x = {-b \pm \sqrt{b^2-4ac} \over 2a}.{{ "{% endmath "}} %}</code></p>

<p>You can get pretty fancy, for instance, the wave equation&rsquo;s nabla is no big thing{% math %}\frac{\partial<sup>2</sup> y}{\partial t<sup>2</sup>}= c<sup>2</sup>\nabla<sup>2u</sup>{% endmath %}</p>

<p>All of the standard Latex equation markup is available to use inside these block tags.</p>

<h3>Full Width Figures</h3>

<p>If you need a full-width image or figure, another custom liquid tag is available to use. Oddly enough, it is named &lsquo;fullwidth&rsquo;, and this markup:</p>

<p><code>{{ "{% fullwidth /assets/img/figure2.png 'Full width figure' "}} %}</code></p>

<p>Yields this:</p>

<p>{% fullwidth /assets/img/figure2.png &lsquo;Full width figure&rsquo; %}</p>

<p><code>qplot(wt, mpg, data = mtcars, colour = factor(cyl) )</code></p>

<h3>Main Column Figures</h3>

<p>Besides margin and full width figures, you can of course also include figures constrained to the main column. Yes, you guessed it, a custom liquid tag rides to the rescue once again:</p>

<p><code>{{ "{% maincolumn /assets/img/figure3.png 'This is a caption for the image to the left' "}} %}</code></p>

<p>yields this:</p>

<p>{% maincolumn /assets/img/figure3.png &lsquo;This is a caption for the image to the left&rsquo; %}</p>

<h2>Sidenotes and Margin notes</h2>

<p>One of the most prominent and distinctive features of Tufte&rsquo;s style is the extensive use of sidenotes and margin notes. Perhaps you have noticed their use in this document already. You are very astute.</p>

<p>There is a wide margin to provide ample room for sidenotes and small figures. I have preserved a slight semantic distinction between <em>sidenotes</em> and <em>marginnotes</em>.</p>

<h3>Sidenotes</h3>

<p>Sidenotes{% sidenote 3 &lsquo;This is a sidenote and <em>contains a superscript</em>&rsquo;%} contain a superscript. Right now, it is up to you to maintain the numbering system with these Liquid tags. Perhaps some clever person who takes a shine to this Jekyll theme will fork the repository and use some Ruby-fu and modify the <code>sidenote.rb</code> plugin to keep track of the numbering for you. But right now, a sidenote like the one here is created with the following markup in Markdown (what?):</p>

<p><code>{{ "{% sidenote 3 'This is a sidenote and *contains a superscript*'" }}%}</code></p>

<h3>Margin notes</h3>

<p>Margin notes{% marginnote &lsquo;This is a margin note <em>without</em> a superscript&rsquo; %} are similar to sidenotes, but do not contain a superscript. You can place anything you want in a margin note. Well, anything that is an inline element. Block level elements can make the Kramdown parser do strange things. Same sort of markup as a sidenote, but without a number involved:</p>

<p><code>{{ "{% marginnote 'This is a margin note *without* a superscript'" }} %}</code></p>

<h2>Tables</h2>

<p>Tabular data is presented with right-aligned text and minimal grid lines. Table captions are placed inside a <em>marginnote</em> Liquid Tag above the table. Be careful to leave a blank line between the marginnote and the beginning of the table to avoid goofy shit happening during the parsing step.</p>

<p>Of course, a table can be created using the usual html markup (<code>&lt;table&gt;&lt;thead&gt;&lt;tbody&lt;tr&gt;&lt;td&gt; etc..</code>)</p>

<p> {% marginnote &lsquo;Table 1: first row of metcars&rsquo; %}</p>

<table>
  <thead><th></th><th>mpg</th><th>cyl</th><th>disp</th><th>hp</th><th>drat</th><th>wt</th></thead>
  <tbody>
    <tr><td>Mazda RX4</td><td>21.00</td><td>6.00</td><td>160.00</td><td>110.00</td><td>3.90</td><td>2.62</td></tr>
    <tr><td>Mazda RX4 Wag</td><td>21.00</td><td>6.00</td><td>160.00</td><td>110.00</td><td>3.90</td><td>2.88</td></tr>
    <tr><td>Datsun 710</td><td>22.80</td><td>4.00</td><td>108.00</td><td>93.00</td><td>3.85</td><td>2.32</td></tr>
    <tr><td>Hornet 4 Drive</td><td>21.40</td><td>6.00</td><td>258.00</td><td>110.00</td><td>3.08</td><td>3.21</td></tr>
    <tr><td>Hornet Sportabout</td><td>18.70</td><td>8.00</td><td>360.00</td><td>175.00</td><td>3.15</td><td>3.44</td></tr>
    <tr><td>Valiant</td><td>18.10</td><td>6.00</td><td>225.00</td><td>105.00</td><td>2.76</td><td>3.46</td></tr>
  </tbody>
</table>


<p>{% newthought Or %} you can avail yourself of the Markdown Extra features built into Kramdown, and use the Markdown Extra table syntax to make the very same thing:</p>

<p>{% marginnote &lsquo;Table 2: same table with Markdown Extra markup and sane numerical precision&rsquo; %}</p>

<table>
<thead>
<tr>
<th align="right">                 </th>
<th align="right">mpg  </th>
<th align="right"> cyl  </th>
<th align="right">  disp  </th>
<th align="right">   hp   </th>
<th align="right">  drat  </th>
<th align="right"> wt  </th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">Mazda RX4        </td>
<td align="right">21   </td>
<td align="right">6     </td>
<td align="right">160     </td>
<td align="right">110     </td>
<td align="right">3.90    </td>
<td align="right">2.62 </td>
</tr>
<tr>
<td align="right">Mazda RX4 Wag    </td>
<td align="right">21   </td>
<td align="right">6     </td>
<td align="right">160     </td>
<td align="right">110     </td>
<td align="right">3.90    </td>
<td align="right">2.88 </td>
</tr>
<tr>
<td align="right">Datsun 710       </td>
<td align="right">22.8 </td>
<td align="right">4     </td>
<td align="right">108     </td>
<td align="right">93      </td>
<td align="right">3.85    </td>
<td align="right">2.32 </td>
</tr>
<tr>
<td align="right">Hornet 4 Drive   </td>
<td align="right">21.4 </td>
<td align="right">6     </td>
<td align="right">258     </td>
<td align="right">110     </td>
<td align="right">3.08    </td>
<td align="right">3.21 </td>
</tr>
<tr>
<td align="right">Hornet Sportabout</td>
<td align="right">18.7 </td>
<td align="right">8     </td>
<td align="right">360     </td>
<td align="right">175     </td>
<td align="right">3.15    </td>
<td align="right">3.44 </td>
</tr>
<tr>
<td align="right">Valiant          </td>
<td align="right">18.1 </td>
<td align="right">6     </td>
<td align="right">160     </td>
<td align="right">105     </td>
<td align="right">2.76    </td>
<td align="right">3.46 </td>
</tr>
</tbody>
</table>


<p>Using the following markup(down):</p>

<p><code>
|                 |mpg  | cyl  |  disp  |   hp   |  drat  | wt  |
|----------------:|----:|-----:|-------:|-------:|-------:|----:|
|Mazda RX4        |21   |6     |160     |110     |3.90    |2.62 |
etc..
</code></p>

<h2>Code</h2>

<p>Code samples use a monospace font using the &lsquo;code&rsquo; class. The Kramdown parser has the &lsquo;GFM&rsquo; option enabled, which stands for &lsquo;Github Flavored Markdown&rsquo;, and this means that both inline code such as <code>#include &lt;stdio.h&gt;</code> and blocks of code can be delimited by surrounding them with 3 backticks:</p>

<p><code>
(map tufte-style all-the-things)
</code>
is created by the following markup:</p>

<pre><code>```(map tufte-style all-the-things)```</code></pre>


<p>In theory, one should be able to append the language name right after the first three backticks and get some sexy code syntax highlighting, but for some reason, the only way I can make this work with the Kramdown and Rouge highlighting turned on is to enclose a block of code in the some Liquid tags. For instance, here is the Ruby code for one of the plugins included with this theme:</p>

<p>{% highlight ruby %}
module Jekyll
  class RenderFullWidthTag &lt; Liquid::Tag
require &ldquo;shellwords&rdquo;</p>

<pre><code>def initialize(tag_name, text, tokens)
  super
  @text = text.shellsplit
end

def render(context)
  "&lt;div&gt;&lt;img class='fullwidth' src='#{@text[0]}'/&gt;&lt;/div&gt; " +
  "&lt;p&gt;&lt;span class='marginnote'&gt;#{@text[1]}&lt;/span&gt;&lt;/p&gt;"
end
</code></pre>

<p>  end
end</p>

<p>Liquid::Template.register_tag(&lsquo;fullwidth&rsquo;, Jekyll::RenderFullWidthTag)
{% endhighlight %}</p>

<p>Which is created by surrounding the code with the <em>highlight</em> tag block pair:</p>

<p><code>
{{ "{% highlight ruby" }} %}
module Jekyll
  blah, blah...
Liquid::Template.register_tag('fullwidth', Jekyll::RenderFullWidthTag)
{{ "{% endhighlight" }} %}
</code>
For some reason, the <em>linenos</em> tag modifier in the highlight tag totally screws up the code alignment, and I don&rsquo;t feel like sorting it out at the moment. So either don&rsquo;t use it, or figure it out and tell me what is going on so I can fix it.</p>
